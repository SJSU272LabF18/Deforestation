<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta name="viewport" content="initial-scale=1, maximum-scale=1,user-scalable=no">

  <link rel="stylesheet" href="https://js.arcgis.com/3.26/dijit/themes/claro/claro.css">
  <link rel="stylesheet" href="https://js.arcgis.com/3.26/esri/css/esri.css">
<!-- Favicon -->
<link href="img/brand/favicon.png" rel="icon" type="image/png">
<!-- Fonts -->
<link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,600,700" rel="stylesheet">
<!-- Icons -->
<link href="vendor/nucleo/css/nucleo.css" rel="stylesheet">
<link href="vendor/@fortawesome/fontawesome-free/css/all.min.css" rel="stylesheet">
<!-- Argon CSS -->
<link type="text/css" href="css/argon.css?v=1.0.0" rel="stylesheet">

<style>
    html, body {
      height: 100%;
      padding: 0;
      margin: 0;
    }
    #map{
      height: 80%;
      width: 70%;
      padding: 0;
      margin: 0;
    }
    #leftPane{
      width: 20%;
    }
    #layerListPane{
    width:0px;
    }
    .esriLayerList .esriList{
        border-top:none;
    }
    .esriLayerList .esriTitle {
      background-color: #fff;
      border-bottom:none;
    }
    .esriLayerList .esriList ul{
      background-color: #fff;
    }
</style>

<script src="https://js.arcgis.com/3.26/"></script>

<!-- <script>
  require(["esri/map","esri/arcgis/utils", "dojo/domReady!"], 
  function(Map, arcgisUtils) {
    map = new Map("map", {
      basemap : "hybrid",
      center : [-122.45, 37.75],
      zoom : 13
    })
  });
</script> -->
<script>var dojoConfig = { parseOnLoad: true };</script>
<script>
  var map, tb;
  
  require([          
          "dojo/dom",
  
          "dojo/_base/array",
          "dojo/parser",
          "dojo/query",
          "dojo/on",
  
          "esri/Color",
          "esri/config",
          "esri/map",
          "esri/graphic",
  
          "esri/geometry/normalizeUtils",
          "esri/tasks/GeometryService",
          "esri/tasks/BufferParameters",
    
          "esri/toolbars/draw",
    
          "esri/symbols/SimpleMarkerSymbol",
          "esri/symbols/SimpleLineSymbol",
          "esri/symbols/SimpleFillSymbol",
          
          "esri/arcgis/utils",
          "esri/dijit/LayerList",
          "esri/layers/FeatureLayer",
          
          "esri/geometry/webMercatorUtils",
          "esri/geometry/Point",
          "dijit/layout/BorderContainer",
          "dijit/layout/ContentPane",
          "dijit/form/Button", 
          "dojo/domReady!"
          ],
        function(dom, array, parser, query, on, Color, esriConfig, Map, Graphic, normalizeUtils, GeometryService, BufferParameters, Draw, SimpleMarkerSymbol, SimpleLineSymbol, SimpleFillSymbol,
                 arcgisUtils, LayerList, FeatureLayer,
                 webMercatorUtils, Point ){
  
          parser.parse();
          esriConfig.defaults.geometryService = new GeometryService("https://utility.arcgisonline.com/ArcGIS/rest/services/Geometry/GeometryServer");
  
          esriConfig.defaults.io.proxyUrl = "/proxy/";
          esriConfig.defaults.io.alwaysUseProxy = false;
  
  
         //Setup button click handlers
          on(dom.byId("clearGraphics"), "click", function(){
            if(map){
              map.graphics.clear();
            }
          });
          //click handler for the draw tool buttons
          query(".tool").on("click", function(evt){
            if(tb){
             tb.activate(evt.target.id);
            }
          });
           // add layers
           
            
          // var HighwayLayer = new FeatureLayer({
          //   url: "https://services9.arcgis.com/1Y7xLGjga1P93hYo/arcgis/rest/services/tl_2014_41_prisecroads/FeatureServer", 
            
          //   }); //renderer: hwyRenderer
          //-------------------------create map
          map = new Map("map", {
            basemap: "streets",
            center: [-120.652, 43.646],
            zoom: 7
          });
          var ForestLayer = new FeatureLayer("https://services9.arcgis.com/1Y7xLGjga1P93hYo/ArcGIS/rest/services/forestland/FeatureServer/0");
          map.addLayer(ForestLayer);
          
          var HighwayLayer = new FeatureLayer("https://services9.arcgis.com/1Y7xLGjga1P93hYo/arcgis/rest/services/tl_2014_41_prisecroads/FeatureServer/0");
          map.addLayer(HighwayLayer);
          
          // map.center([-82.44109, 35.6122]); 
          
          map.on("load", initToolbar);
        
        //-------------------------Buffer
        function initToolbar(evtObj) {
          tb = new Draw(evtObj.map);
          tb.on("draw-end", doBuffer);
        }
  
        function doBuffer(evtObj) {
          tb.deactivate();
          var geometry = evtObj.geometry
          var symbol;
          switch (geometry.type) {
             case "point":
               symbol = new SimpleMarkerSymbol(SimpleMarkerSymbol.STYLE_SQUARE, 10, new SimpleLineSymbol(SimpleLineSymbol.STYLE_SOLID, new Color([255,0,0]), 1), new Color([0,255,0,0.25]));
               break;
             case "polyline":
               symbol = new SimpleLineSymbol(SimpleLineSymbol.STYLE_DASH, new Color([255,0,0]), 1);
               break;
             case "polygon":
               symbol = new SimpleFillSymbol(SimpleFillSymbol.STYLE_NONE, new SimpleLineSymbol(SimpleLineSymbol.STYLE_DASHDOT, new Color([255,0,0]), 2), new Color([255,255,0,0.25]));
               break;
          }
  
            var graphic = new Graphic(geometry, symbol);
            map.graphics.add(graphic);
  
            //setup the buffer parameters
            var params = new BufferParameters();
            params.distances = [ dom.byId("distance").value ];
            params.outSpatialReference = map.spatialReference;
            params.unit = GeometryService[dom.byId("unit").value];
            
            //normalize the geometry 
            normalizeUtils.normalizeCentralMeridian([geometry]).then(function(normalizedGeometries){
              var normalizedGeometry = normalizedGeometries[0];
              if (normalizedGeometry.type === "polygon") {
                //if geometry is a polygon then simplify polygon.  This will make the user drawn polygon topologically correct.
                esriConfig.defaults.geometryService.simplify([normalizedGeometry], function(geometries) {
                  params.geometries = geometries;
                  esriConfig.defaults.geometryService.buffer(params, showBuffer);
                });
              } else {
                params.geometries = [normalizedGeometry];
                esriConfig.defaults.geometryService.buffer(params, showBuffer);
              }
  
            });
          }
  
          function showBuffer(bufferedGeometries) {
            var symbol = new SimpleFillSymbol(
              SimpleFillSymbol.STYLE_SOLID,
              new SimpleLineSymbol(
                SimpleLineSymbol.STYLE_SOLID,
                new Color([255,0,0,0.65]), 2
              ),
              new Color([255,0,0,0.35])
            );
  
            array.forEach(bufferedGeometries, function(geometry) {
              var graphic = new Graphic(geometry, symbol);
              map.graphics.add(graphic);
            });
          }
         
          //-------------------------show coordinates
          map.on("load", function() {
            //after map loads, connect to listen to mouse move & drag events
            map.on("mouse-move", showCoordinates);
            map.on("mouse-drag", showCoordinates);
            function showCoordinates(evt) {
              //the map is in web mercator but display coordinates in geographic (lat, long)
              var mp = webMercatorUtils.webMercatorToGeographic(evt.mapPoint);
              //display mouse coordinates
              dom.byId("info").innerHTML = mp.x.toFixed(3) + ", " + mp.y.toFixed(3);
            }
          });
        //------ Input Long, Lat from user and display point
        var symbol = new SimpleMarkerSymbol(  
                SimpleMarkerSymbol.STYLE_CIRCLE,  
                15,  
                new SimpleLineSymbol(  
                    SimpleLineSymbol.STYLE_SOLID,  
                    new Color([0, 0, 255, 0.5]),  
                    8  
                    ),  
                new Color([0, 0, 255])  
             );  
      
        on(dom.byId("go"), "click", coordinates);  
        function coordinates() {  
          console.log("got here")  
            var lat = document.getElementById("sel_lat").value  
            var long1 = document.getElementById("sel_long").value  
            var mp = new Point(long1, lat);  
            var graphic = new Graphic(mp, symbol);  
            map.graphics.add(graphic);  
        }  
          
  
    });
  </script>

</head>


<body class = "claro">

    <div class="row">
        <div class="container-fluid mt--7">
            <div class="row">
              <div class="col">
                <!-- <div class="card shadow border-0"> -->
                  <!-- <div id="map-canvas" class="map-canvas" data-lat="40.748817" data-lng="-73.985428" style="height: 600px;"></div> -->
                  <!-- <div id="viewDiv" style="height:600px;"></div> -->
                <div class="card-body px-lg-5 py-lg-5" >
                          
                          <form action="http://127.0.0.1:4500/submit-tender" method="post">
                            <div class="form-group">
                              <div class="input-group input-group-alternative mb-3">
                                
                                <input class="form-control" placeholder="Project Name" name="projectName" type="text">
                              </div>
                            </div>

                            <div class="form-group">
                                  <div class="input-group input-group-alternative mb-3">
                                    
                                    <input class="form-control" placeholder="Tender Company" name="company" type="text">
                                  </div>
                              </div>

                            <div class="form-group">
                              <div class="input-group input-group-alternative mb-3">
                                
                                <input class="form-control" placeholder="Enter the longitude of the position you want to start from" name="loc_longitude" type="text">
                              </div>
                            </div>
                            <div class="form-group">
                              <div class="input-group input-group-alternative">
                                <div class="input-group-prepend">
                                </div>
                                <input class="form-control" placeholder="Enter the latitude of the position you want to start from" name="loc_latitude" type="text">
                              </div>
                            </div>
                            
                           
                            <div class="text-center">
                              <button type="submit" class="btn btn-primary mt-4">Submit your Tender</button>
                            </div>
                          </form>
                        </div>
                </div>
              </div>
            </div>
      
    </div>
      


<div data-dojo-type="dijit/layout/BorderContainer" 
data-dojo-props="gutters:'true', design:'sidebar'" 
style="width:100%;height:100%;">

  

  <div id="map" 
      data-dojo-type="dijit/layout/ContentPane" 
      data-dojo-props="region:'center'">
  </div>

  <div id="leftPane" 
      data-dojo-type="dijit/layout/ContentPane" 
      data-dojo-props="region:'left'">
    <div class="details">Pick a tool and draw on the map. The drawn graphic will be buffered based on the specified parameters.</div>
    <button type="button" class="btn btn-primary mt-2 tool" id="line" style="height:25px; padding-bottom: 25px">Line</button>
    <button type="button" class="btn btn-primary mt-2 tool" id="polyline" style="height:25px; padding-bottom: 25px">Polyline</button>
    <button type="button" class="btn btn-primary mt-2 tool" id="freehandpolyline" style="height:25px; padding-bottom: 25px">Freehand Polyline</button>
    <br/>
    <button type="button" class="btn btn-primary mt-2 tool" id="polygon" style="height:25px; padding-bottom: 25px">Polygon</button>
    <button type="button" class="btn btn-primary mt-2 tool" id="freehandpolygon" style="height:25px; padding-bottom: 25px">Freehand Polygon</button>
    <br/><hr />
    <div><b>Buffer Parameters</b></div>
    Distance:&nbsp;<input type="text" id="distance" size="5" value="25" />
    <select class="btn btn-primary mt-2 tool" id="unit" style="width:100px;">
      <option value="UNIT_STATUTE_MILE">Miles</option>
      <option value="UNIT_FOOT">Feet</option>
      <option value="UNIT_KILOMETER">Kilometers</option>
      <option value="UNIT_METER">Meters</option>
      <option value="UNIT_NAUTICAL_MILE">Nautical Miles</option>
      <option value="UNIT_US_NAUTICAL_MILE">US Nautical Miles</option>
      <option value="UNIT_DEGREE">Degrees</option>
    </select><br />
    <button class="btn btn-primary mt-2 tool" type="button" id="clearGraphics" style="height:25px; padding-bottom: 25px">Clear Graphics</button>
  
    <span id="info"></span>
    <hr/>
    <div><b>Input coordinates</b></div>
  <!-- INPUT LONG, LAT -->
      Tag Long:<input id="sel_long" type="text">  
      <br >  
       Tag Lat:<input id="sel_lat" type="text">  
      <br >  
      <button id="go">GO</button>

    <ul class="navbar-nav" style="margin-top:50px;">
        <li class="nav-item">
          <a class="nav-link" href="/">
            <i class="ni ni-tv-2 text-primary"></i> Dashboard
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/submit-tender">
            <i class="ni ni-planet text-blue"></i> Submit your Tender
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link active" href="/findMaps">
            <i class="ni ni-pin-3 text-orange"></i> Maps
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="../examples/profile.html">
            <i class="ni ni-single-02 text-yellow"></i> Government Policies
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="../examples/tables.html">
            <i class="ni ni-bullet-list-67 text-red"></i> Contact us
          </a>
        </li>
        
      </ul>

  </div>

</div>

</body>


</html>
